# Синтаксис сложных условий для модификаторов цен

## Обзор

Система модификаторов цен поддерживает два способа определения условий применения:

1. **Простые условия** - через `propertyId` и `propertyValue`
2. **Сложные условия** - через `conditionExpression` с SQL-подобным синтаксисом

## Простые условия (устаревший способ)

```json
{
  "propertyId": 123,
  "propertyValue": "премиум"
}
```

Применяется когда свойство с ID=123 имеет значение "премиум".

## Сложные условия (рекомендуемый способ)

Используйте поле `conditionExpression` для гибкого определения условий.

### Базовые операторы сравнения

#### Равенство
```sql
propertyValue = 'премиум'
propertyId = 123
```

#### Неравенство
```sql
propertyValue != 'базовый'
propertyId != 456
```

#### Числовые сравнения
```sql
propertyValue > 1000
propertyValue < 5000
propertyValue >= 1000
propertyValue <= 5000
```

### Логические операторы

#### AND (И)
```sql
propertyId = 123 AND propertyValue = 'премиум'
```

#### OR (ИЛИ)
```sql
propertyId = 123 OR propertyId = 456
```

#### NOT (НЕ)
```sql
NOT propertyId = 123
```

#### Комбинирование
```sql
(propertyId = 123 AND propertyValue = 'премиум') OR (propertyId = 456 AND propertyValue = 'стандарт')
```

### Расширенные операторы

#### LIKE (поиск по шаблону)
Поддерживает `%` как wildcard символ:
```sql
propertyValue LIKE 'цвет:%'
propertyValue LIKE '%красный%'
propertyValue LIKE 'модель_A%'
```

#### IN (вхождение в список)
```sql
propertyValue IN ('красный', 'синий', 'зеленый')
propertyId IN (123, 456, 789)
```

#### BETWEEN (в диапазоне)
```sql
propertyValue BETWEEN 1000 AND 5000
```

### Приоритет операторов

1. Скобки `()` - самая высокая приоритетность
2. `NOT`
3. `AND`
4. `OR` - самая низкая приоритетность

### Примеры реальных кейсов

#### 1. Надбавка для дорогих товаров
```sql
propertyValue > 3000
```

#### 2. Скидка для определенных цветов
```sql
propertyValue IN ('белый', 'бежевый', 'серый')
```

#### 3. Модификатор для товаров в ценовом диапазоне
```sql
propertyValue BETWEEN 1500 AND 4000
```

#### 4. Комбинированное условие
```sql
(propertyId = 1 AND propertyValue = 'фасад') AND (propertyValue > 2000)
```

#### 5. Сложная бизнес-логика
```sql
(propertyValue LIKE 'цвет:%' AND propertyValue IN ('цвет:красный', 'цвет:синий')) 
OR 
(propertyValue > 5000 AND NOT propertyValue LIKE 'временный%')
```

## Валидация

### Правила использования
- Нельзя одновременно использовать простые и сложные условия
- `conditionExpression` не может быть пустой строкой при использовании
- Синтаксис должен быть корректным SQL-подобным выражением

### Ошибки
- `400 Bad Request` - синтаксическая ошибка в выражении
- `400 Bad Request` - попытка использовать обе системы условий одновременно

## Рекомендации

1. **Используйте сложные условия** для гибкой настройки
2. **Группируйте сложные выражения скобками** для ясности
3. **Избегайте избыточной вложенности** - максимум 3 уровня
4. **Тестируйте условия** перед продакшеном

## Совместимость

- Простые условия остаются поддерживаемыми для обратной совместимости
- Новые разработки должны использовать сложные условия
- В будущих версиях простые условия могут быть deprecated