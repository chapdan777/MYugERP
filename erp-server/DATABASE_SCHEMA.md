# –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö ERP-—Å–∏—Å—Ç–µ–º—ã

–ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞ –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ `1704710000000-InitialSchema.ts`

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–í—Å–µ–≥–æ —Å–æ–∑–¥–∞–Ω–æ **36 —Ç–∞–±–ª–∏—Ü**, —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã—Ö –Ω–∞ 9 –¥–æ–º–µ–Ω–æ–≤:

### 1. –î–û–ú–ï–ù: –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò (2 —Ç–∞–±–ª–∏—Ü—ã)
- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã (–∫–ª–∏–µ–Ω—Ç—ã, –º–µ–Ω–µ–¥–∂–µ—Ä—ã, —Ä–∞–±–æ—Ç–Ω–∏–∫–∏, –∞–¥–º–∏–Ω—ã)
- `user_properties` - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 2. –î–û–ú–ï–ù: –ù–û–ú–ï–ù–ö–õ–ê–¢–£–†–ê (1 —Ç–∞–±–ª–∏—Ü–∞)
- `products` - –∫–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–¥—É–∫—Ü–∏–∏

### 3. –î–û–ú–ï–ù: –°–í–û–ô–°–¢–í–ê (3 —Ç–∞–±–ª–∏—Ü—ã)
- `properties` - –∞—Ç—Ä–∏–±—É—Ç—ã –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- `product_properties` - —Å–≤—è–∑—å –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å–æ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏
- `property_dependencies` - –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏–π —Å–≤–æ–π—Å—Ç–≤

### 4. –î–û–ú–ï–ù: –¶–ï–ù–û–û–ë–†–ê–ó–û–í–ê–ù–ò–ï (1 —Ç–∞–±–ª–∏—Ü–∞)
- `price_modifiers` - –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Ü–µ–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–≤–æ–π—Å—Ç–≤

### 5. –î–û–ú–ï–ù: –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø (3 —Ç–∞–±–ª–∏—Ü—ã)
- `order_templates` - —à–∞–±–ª–æ–Ω—ã –∑–∞–∫–∞–∑–æ–≤
- `order_section_templates` - —à–∞–±–ª–æ–Ω—ã —à–∞–ø–æ–∫ –∑–∞–∫–∞–∑–æ–≤
- `section_template_properties` - —Å–≤–æ–π—Å—Ç–≤–∞ –≤ —à–∞–±–ª–æ–Ω–µ —à–∞–ø–∫–∏

### 6. –î–û–ú–ï–ù: –ó–ê–ö–ê–ó–´ (5 —Ç–∞–±–ª–∏—Ü)
- `orders` - –∑–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤
- `order_sections` - —à–∞–ø–∫–∏ –∑–∞–∫–∞–∑–æ–≤
- `order_items` - –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–æ–≤
- `properties_in_order` - –∑–Ω–∞—á–µ–Ω–∏—è —Å–≤–æ–π—Å—Ç–≤ –≤ –ø–æ–∑–∏—Ü–∏—è—Ö
- `order_logs` - –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–∞–∫–∞–∑–æ–≤

### 7. –î–û–ú–ï–ù: –ü–†–û–ò–ó–í–û–î–°–¢–í–û (9 —Ç–∞–±–ª–∏—Ü)
- `operations` - –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `operation_rates` - —Ä–∞—Å—Ü–µ–Ω–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
- `technological_routes` - —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã
- `route_steps` - —à–∞–≥–∏ –º–∞—Ä—à—Ä—É—Ç–∞
- `production_departments` - –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏
- `department_operations` - –æ–ø–µ—Ä–∞—Ü–∏–∏ —É—á–∞—Å—Ç–∫–∞
- `work_orders` - –∑–∞–∫–∞–∑-–Ω–∞—Ä—è–¥—ã
- `work_order_items` - –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑-–Ω–∞—Ä—è–¥–æ–≤

### 8. –î–û–ú–ï–ù: –¢–†–£–î–û–í–´–ï –†–ï–°–£–†–°–´ (3 —Ç–∞–±–ª–∏—Ü—ã)
- `worker_qualifications` - –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤
- `worker_assignments` - –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ –Ω–∞ –∑–∞–∫–∞–∑-–Ω–∞—Ä—è–¥—ã
- `salary_profiles` - –ø—Ä–æ—Ñ–∏–ª–∏ –∑–∞—Ä–∞–±–æ—Ç–Ω–æ–π –ø–ª–∞—Ç—ã

### 9. –î–û–ú–ï–ù: –ë–£–•–ì–ê–õ–¢–ï–†–ò–Ø (3 —Ç–∞–±–ª–∏—Ü—ã)
- `payments` - –ø–ª–∞—Ç–µ–∂–∏ –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤
- `client_balances` - –±–∞–ª–∞–Ω—Å—ã –∫–ª–∏–µ–Ω—Ç–æ–≤
- `order_payment_allocations` - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–ø–ª–∞—Ç –ø–æ –∑–∞–∫–∞–∑–∞–º

### 10. –î–û–ú–ï–ù: –ê–£–î–ò–¢ (1 —Ç–∞–±–ª–∏—Ü–∞)
- `audit_logs` - –∂—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π

## üîë –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã

–°–æ–∑–¥–∞–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:
- –ü–æ —Ä–æ–ª—è–º –∏ —Å—Ç–∞—Ç—É—Å–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü–æ –∫–ª–∏–µ–Ω—Ç–∞–º –∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º –≤ –∑–∞–∫–∞–∑–∞—Ö
- –ü–æ —Å—Ç–∞—Ç—É—Å–∞–º –∏ –¥–µ–¥–ª–∞–π–Ω–∞–º –∑–∞–∫–∞–∑–æ–≤
- –ü–æ —Å—Ç–∞—Ç—É—Å–∞–º –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º –∑–∞–∫–∞–∑-–Ω–∞—Ä—è–¥–æ–≤
- –ü–æ –∫–ª–∏–µ–Ω—Ç–∞–º –∏ –¥–∞—Ç–∞–º –ø–ª–∞—Ç–µ–∂–µ–π
- –ü–æ —Ç–∏–ø–∞–º —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –º–µ—Ç–∫–∞–º –≤ –∞—É–¥–∏—Ç–µ

## üöÄ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é (—Å–æ–∑–¥–∞—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã)
npm run migration:run

# –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é (—É–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã)
npm run migration:revert
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `SERIAL` –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π (–∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç)
- –í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å CASCADE –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º—ã—Ö –∑–∞–ø–∏—Å–µ–π
- Timestamps (`created_at`, `updated_at`) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è
- CHECK constraints –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
- UNIQUE constraints –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

## üîÑ –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã:
1. **Order** (orders ‚Üí order_sections ‚Üí order_items ‚Üí properties_in_order)
2. **WorkOrder** (work_orders ‚Üí work_order_items)
3. **User** (—Å–≤—è–∑–∞–Ω —Å–æ –≤—Å–µ–º–∏ –¥–æ–º–µ–Ω–∞–º–∏)
4. **Product** (products ‚Üí product_properties, technological_routes)

### –ö–ª—é—á–µ–≤—ã–µ —Å–≤—è–∑–∏:
- Orders ‚Üí Users (client_id, agent_id)
- WorkOrders ‚Üí Orders, Departments
- Payments ‚Üí Users (client_id)
- WorkerAssignments ‚Üí WorkOrders, Users
- Properties ‚Üí Products (—á–µ—Ä–µ–∑ product_properties)

–≠—Ç–∞ —Å—Ö–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–µ–∫—Ç–Ω–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—É –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã ERP-—Å–∏—Å—Ç–µ–º—ã.
